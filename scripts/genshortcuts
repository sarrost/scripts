#!/bin/sh

#〖愛〗This script generates shell and file manager 
# shortcuts for changing to, copying and moving files to 
# directories specified in a config file.
#
# Usage:
#   genshortcuts [--verbose]
#
# New files are created for the shortcuts. The script is
# non-verbose by default. When verbose the new files are 
# additionally printed to stdout.

# Process args
script_name=`basename $0`
verbose=false
[ ! -z "$1" ] && [ "$1" = "--verbose" ] && verbose=true

# Some colors.
COLOR1='\033[0;31m' # STANDARD RED
NC='\033[0m' # No Color

# Input
dirs="$XDG_CONFIG_HOME/genshortcuts/dirsrc"

# Output locations
shell_shortcuts="$XDG_CONFIG_HOME/zsh/config/shortcuts.zsh"
vifm_shortcuts="$XDG_CONFIG_HOME/vifm/config/shortcuts.vifm"

# Remove old files
rm -f "$shell_shortcuts" "$vifm_shortcuts" 2>/dev/null
[ $verbose = true ] && \
echo -e "Remove files: $shell_shortcuts, $vifm_shortcuts"

# Prepare new files
printf \
"#!/bin/sh\n\n"\
"# THIS FILE WAS AUTOGENERATED BY THE "\
"\`$script_name\` SCRIPT.\n\n" \
> "$shell_shortcuts"

printf \
"\" THIS FILE WAS AUTOGENERATED BY THE"\
" \`$script_name\` SCRIPT.\n\n" \
> "$vifm_shortcuts"

[ $verbose = true ] && \
echo -e "Create files: $shell_shortcuts, $vifm_shortcuts"

# Remove comment, empty & whitespace-only lines
prepared_kv=`sed "/^\s*$/d;/\s*#.*$/d" $dirs`

# Print output file for debug purposes
print_file() {
	echo -e "${COLOR1}$1${NC}" && \
	cat $1 && \
	echo ""
}

############################################################
# Shell
############################################################
echo "${prepared_kv}" \
	| awk '{printf "alias g%s=\"cd %s\"\n", $1, $2}' \
	| sed '$ s/\\$//' \
	>> $shell_shortcuts

echo "${prepared_kv}" \
	| awk '{printf "yp%s(){ cp \"$@\" \"%s\" }\n", $1, $2}' \
	>> $shell_shortcuts

echo "${prepared_kv}" \
	| awk '{printf "mv%s(){ mv \"$@\" \"%s\" }\n", $1, $2}' \
	>> $shell_shortcuts

[ $verbose = true ] && print_file $shell_shortcuts


############################################################
# Vifm
############################################################
# Quick cd mapping
echo "${prepared_kv}" \
	| awk '{printf "nnoremap '"'"'%s :cd %s<CR>\n", $1, $2}' \
	>> $vifm_shortcuts

# Quick move command & mapping
echo "${prepared_kv}" \
	| awk '{printf "command! mv%s :!mv %%f %s\n", $1, $2}' \
	>> $vifm_shortcuts

echo "${prepared_kv}" \
	| awk '{printf "nnoremap mv%s :!mv %%f %s<CR>\n", $1, $2}' \
	>> $vifm_shortcuts

# Quick yank/put command & mapping
echo "${prepared_kv}" \
	| awk '{printf "command! yp%s :!cp %%f %s\n", $1, $2}' \
	>> $vifm_shortcuts

echo "${prepared_kv}" \
	| awk '{printf "nnoremap yp%s :!cp %%f %s<CR>\n", $1, $2}' \
	>> $vifm_shortcuts

printf "\n\" v""im: filetype=vifm" >> $vifm_shortcuts

[ $verbose = true ] && print_file $vifm_shortcuts
